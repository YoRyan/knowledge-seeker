{% import 'base.html' as base %}
{% extends 'base.html' %}

{% set slug_kwargs = { 'season': info['season.slug'], 'episode': info['episode.slug'] } %}
{% set this_subtitle = none %}
{% for row in subtitles %}
        {% if ms >= row['subtitle.start_ms']
              and ms <= row['subtitle.end_ms'] %}
              {% set this_subtitle = row %}
        {% endif %}
{% endfor %}
 
{% block title %}
{% if this_subtitle is none %}
        {{ info['episode.name'] }} - {{ info['season.name'] }}
{% else %}
        "{{ this_subtitle['subtitle.content'] }}" - {{ info['episode.name'] }} - {{ info['season.name'] }}
{% endif %}
{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='moment.css') }}">
{{ base.jquery() }}
{% endblock %}

{% block header %}
{% if info['season.icon_png'] is not none %}
<a href="{{ url_for('explorer.browse_season', season=info['season.slug']) }}">
        <img class="season-icon"
             src="{{ url_for('explorer.season_icon', season=info['season.slug']) }}"
             alt=""></a>
{% endif %}
<a href="{{ url_for('explorer.browse_season', season=info['season.slug']) }}">{{ info['season.name'] }}</a> |
<a href="{{ url_for('explorer.browse_episode', **slug_kwargs) }}">{{ info['episode.name'] }}</a>
{% endblock %}

{% block content %}
<section id="browser">
        <div class="preview-image">
                <img src="{{ url_for('clipper.snapshot', ms=ms, **slug_kwargs) }}"
                     alt="right now">
        </div>
        <div class="preview-links">
                <a class="media-link jpeg"
                   target="_blank"
                   href="{{ url_for('clipper.snapshot', ms=ms, **slug_kwargs) }}">
                        JPEG
                </a>
        </div>
        <div class="subtitle-list">
{% for row in subtitles %}
{% if ms >= row['subtitle.start_ms']
      and ms <= row['subtitle.end_ms'] %}
                <span class="subtitle now">{{ row['subtitle.content'] }}</span>
{% else %}
                <span class="subtitle">
                        <a href="{{ url_for('explorer.browse_moment', ms=row['subtitle.snapshot_ms'], **slug_kwargs) }}">
                                {{ row['subtitle.content'] }}
                        </a>
                </span>
{% endif %}
{% endfor %}
        </div>
        <div class="nav-browser">
{% for nav_ms in nav_list %}
{% if nav_ms == ms %}
                <span class="nav-moment now">
                        <img src="{{ url_for('clipper.snapshot_tiny', ms=ms, **slug_kwargs) }}"
                             alt="right now">
                </span>
{% elif nav_ms < ms %}
{% set nav_offset = ms - nav_ms %}
                <a class="nav-moment past"
                   href="{{ url_for('explorer.browse_moment', ms=nav_ms, **slug_kwargs) }}">
                        <img src="{{ url_for('clipper.snapshot_tiny', ms=nav_ms, **slug_kwargs) }}"
                             alt="{{ nav_offset }}s behind">
                        <span class="offset">
                                <span class="fill"></span>
                                <span class="value">-{{ nav_offset }}ms</span>
                        </span>
                </a>
{% else %}
{% set nav_offset = nav_ms - ms %}
                <a class="nav-moment future"
                   href="{{ url_for('explorer.browse_moment', ms=nav_ms, **slug_kwargs) }}">
                        <img src="{{ url_for('clipper.snapshot_tiny', ms=nav_ms, **slug_kwargs) }}"
                             alt="{{ nav_offset }}s ahead">
                        <span class="offset">
                                <span class="fill"></span>
                                <span class="value">+{{ nav_offset }}ms</span>
                        </span>
                </a>
{% endif %}
{% endfor %}
        </div>
</section>

<script src="{{ url_for('static', filename='moment.js') }}"></script>
{% endblock %}
